---
layout: post
title: Revert Your Mistaken Git Commits
date: '2015-05-23T15:15:00.002-04:00'
author: Michael Callaghan
tags: 
modified_time: '2015-05-23T15:15:48.265-04:00'
thumbnail: https://4.bp.blogspot.com/-qyFNLRHrYhU/VWDRtrkGmyI/AAAAAAAAAas/xfdeukS3c8M/s72-c/github-154769_640.png
---

<div><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-qyFNLRHrYhU/VWDRtrkGmyI/AAAAAAAAAas/xfdeukS3c8M/s1600/github-154769_640.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="200" src="https://4.bp.blogspot.com/-qyFNLRHrYhU/VWDRtrkGmyI/AAAAAAAAAas/xfdeukS3c8M/s200/github-154769_640.png" width="200" /></a></div>Today one of my development teams had a merge problem. We use <a href="https://nvie.com/posts/a-successful-git-branching-model/" rel="nofollow" target="_blank">GitFlow</a>, and it was time to merge from the <b>develop</b> branch to the <b>release</b> branch. If things are done correctly, this should always be a clean, simple merge. It is especially true in this case, because it was our first release for this project, so the <b>release</b> branch should be empty. Except that it wasn’t. Huh? </div><div><br /></div><div>As it turned out, a well-meaning developer on the team knew we were pushing our code into <b>release</b>, so that’s what he did. 
<!--more-->
  The output of `git log --oneline` on the <b>release</b> branch showed something like this: </div><div><br /></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp; &nbsp; &nbsp; 1</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">852291a</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">f575c87</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">83d855d</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">9fa11df</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah&nbsp;</span><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">111b003</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">2b3a530</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">a4c5f54</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah&nbsp;</span><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">b2a62fa</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah&nbsp;</span><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah&nbsp;</span><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">5fb67b9</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">&nbsp;&nbsp;&nbsp;&nbsp; 10</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">4d1a5fc</span> <span style="color: #4c2f2d; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">blah blah blah</span></span></div><div><span style="background-color: white; font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d;">&nbsp;&nbsp;&nbsp;&nbsp; 11</span> <span style="color: #969600; font-stretch: normal; font-style: normal; font-variant-ligatures: no-common-ligatures; font-variant: normal; font-weight: normal; line-height: normal;">ed40aec</span> <span style="color: #4c2f2d;">Initial commit</span></span></div><div><span style="font-family: Consolas;"><span style="background-color: #dfdbc4;"><span style="color: #4c2f2d;"><br /></span></span></span></div><div>No, we really don’t use “blah blah” as commit messages. The problem was that these commits were made directly to the <b>release</b> branch, and not through a merge or pull request from <b>develop</b>, which is the prescribed method. I don’t hold any grudges against the well-intended developer. GitFlow is new on that team, and I mostly blame myself for not setting up a 30-minute discussion ahead of time. </div><div><br /></div><div>Regardless of my feelings or the good intentions of the team, I was faced with a problem I had to solve. The pull request was waiting. The test team was waiting for a release build, and that wasn’t happening.&nbsp;I decided that the best and safest thing to do was to undo each of those commits. </div><div><br /></div><div>So after a bit of Google- and Bing-foo, I landed on some questions and answers at StackOverflow.com that enabled me to find just the right sequence of git commands to fix the&nbsp;<b>release</b> branch. I’m recording the experience here so that I know where to look the next time this happens, and in the hopes it may help someone else. </div><div><br /></div><div>The first thing I had to do was figure out how to revert a series of commits. There were only 11, so I could have done them one at a time, but what if there had been 111 instead? I wanted to understand the process regardless of the number of commits. After reviewing the various commands that are available, I settled on the syntax `git revert <oldest commit="" hash="">..<newest commit="" hash="">`. This actually took a few tries, because most of the documentation said things like “first bad commit” and “last bad commit.” Is “first” the oldest, or is it #1 in the log? Turns out, it’s the oldest, which is the highest number in the commit log. </newest></oldest></div><div><br /></div><div>So, to undo all of those commits in the above list, I used the following commands: </div><div><span style="background-color: white;"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d;">&nbsp;# git revert --no-edit</span> <span style="color: #4c2f2d;">ed40aec..852291a</span></span></span></div><div><span style="background-color: white;"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="color: #4c2f2d;">&nbsp;#</span>&nbsp;<span style="color: #4c2f2d;">git log --oneline</span></span></span></div><div><br /></div><div>The --no-edit flag kept git from prompting me to edit the commit message for each of the 11 reverse commits it made. Instead, it used the original commit message, preceded by the word “Revert.” Fine by me. After that command completed, each&nbsp;of my commits had a mirrored revert, in reverse order. Checking the directory showed that the only thing present was the initial README.md file. Perfect! So the only thing left to do was push the branch back up to the server: </div><div><span style="background-color: white; color: #4c2f2d;"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">&nbsp;# &nbsp;git push origin release</span></span></div><div><br /></div><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--> <br /><div>Back on the server, I checked the open pull request from develop to release, and there were no merge conflicts. I completed the merge request, and the build was able to continue. Now the testers can get on with their work, and we can all live happily ever after — until the next problem, of course.&nbsp;</div>